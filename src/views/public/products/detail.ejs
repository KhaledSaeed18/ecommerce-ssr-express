<div class="container product-detail-container">
    <!-- Back Button -->
    <div class="back-button-container">
        <a href="/products" class="btn btn-secondary">
            <i data-lucide="arrow-left"></i>
            Back to Products
        </a>
    </div>

    <div class="card">
        <div class="product-grid">
            <!-- Product Images -->
            <div class="product-images">
                <% if (product.images && product.images.length> 0) { %>
                    <div id="mainImage" class="main-image"
                        style="background-image: url('<%= product.images[0].url %>');"
                        data-current-url="<%= product.images[0].url %>">
                    </div>
                    <div class="thumbnails-grid">
                        <% product.images.forEach((image, index)=> { %>
                            <img src="<%= image.url %>" alt="<%= image.alt %>" class="thumbnail">
                            <% }); %>
                    </div>
                    <% } else { %>
                        <div
                            style="width: 100%; height: 500px; background: #e0e0e0; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                            <i data-lucide="image" style="width: 96px; height: 96px; opacity: 0.3;"></i>
                        </div>
                        <% } %>
            </div>

            <!-- Product Details -->
            <div class="product-info">
                <% if (product.category) { %>
                    <a href="/categories/<%= product.category.slug %>" class="badge badge-secondary"
                        style="text-decoration: none; margin-bottom: 1rem; display: inline-block;">
                        <%= product.category.name %>
                    </a>
                    <% } %>

                        <h1 style="margin: 0 0 1rem; font-size: 2rem; font-weight: bold;">
                            <%= product.name %>
                        </h1>

                        <div class="price-container">
                            <span style="font-size: 2rem; font-weight: bold; color: var(--primary);">
                                $<%= product.price.toFixed(2) %>
                            </span>
                            <% if (product.comparePrice && product.comparePrice> product.price) { %>
                                <span class="text-muted" style="text-decoration: line-through; font-size: 1.25rem;">
                                    $<%= product.comparePrice.toFixed(2) %>
                                </span>
                                <span class="badge badge-danger">
                                    Save <%= Math.round(((product.comparePrice - product.price) / product.comparePrice)
                                        * 100) %>%
                                </span>
                                <% } %>
                        </div>

                        <div class="stock-info">
                            <div class="flex items-center gap-sm" style="margin-bottom: 0.5rem;">
                                <i data-lucide="package" style="width: 20px; height: 20px;"></i>
                                <strong>Stock:</strong>
                                <% if (product.stock> 0) { %>
                                    <span class="badge badge-success">Available</span>
                                    <% } else { %>
                                        <span class="badge badge-danger">Out of Stock</span>
                                        <% } %>
                            </div>
                        </div>

                        <div style="margin-bottom: 2rem;">
                            <h3 style="margin: 0 0 0.5rem; font-size: 1.25rem;">Description</h3>
                            <p style="line-height: 1.6; color: #666;">
                                <%= product.description %>
                            </p>
                        </div>

                        <% if (product.stock> 0) { %>
                            <% if (isAuthenticated && userRole !=='admin' ) { %>
                                <form action="/cart/add" method="POST" class="add-to-cart-form">
                                    <% if (typeof csrfToken !=='undefined' ) { %>
                                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                        <% } %>
                                            <input type="hidden" name="productId" value="<%= product._id %>">
                                            <input type="hidden" name="quantity" value="1">
                                            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                                                <i data-lucide="shopping-cart"></i>
                                                Add to Cart
                                            </button>
                                </form>
                                <% } else if (isAuthenticated && userRole==='admin' ) { %>
                                    <button class="btn btn-secondary btn-lg" style="width: 100%;" disabled>
                                        <i data-lucide="shield"></i>
                                        Admin cannot add to cart
                                    </button>
                                    <% } else { %>
                                        <a href="/auth/login" class="btn btn-primary btn-lg"
                                            style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none;">
                                            <i data-lucide="log-in"></i>
                                            Login to Add to Cart
                                        </a>
                                        <% } %>
                                            <% } else { %>
                                                <button class="btn btn-secondary btn-lg" style="width: 100%;" disabled>
                                                    <i data-lucide="x-circle"></i>
                                                    Out of Stock
                                                </button>
                                                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal"
    style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.95); cursor: zoom-out;">
    <span
        style="position: absolute; top: 20px; right: 40px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; z-index: 10000;">&times;</span>
    <img id="modalImage"
        style="margin: auto; display: block; max-width: 90%; max-height: 90%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 8px; cursor: zoom-in;">
</div>